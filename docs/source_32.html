<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
  <title>Graham Nelson - The Reliques of Tolti-Aph — 34 of 57</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
  <meta name="author" content="Graham Nelson" />
  <meta name="description" content="A page for the game The Reliques of Tolti-Aph by Graham Nelson." />
  <link rel="stylesheet" href="style.css" type="text/css" media="all" />
</head>

<body>

<div class = "container">

<div class ="sourcecoverimage">
	<span><a href="Cover.jpg"><img src="Small Cover.jpg" border="1"></a></span>
</div>

<div class ="sourceintroduction">
	<h1>
		<span>The Reliques of Tolti-Aph</span> <span class="pagination">— 34 of 57</span>
	</h1>
	<h2>
		<span>Graham Nelson</span>
	</h2>
	<div class ="sourcebibliography">
		<span>Release 3</span>
	</div>
</div>

<div class = "links">
<ul>
<li><a href="index.html">Home page</a></li><li><a href="source.html">Beginning</a></li><li><a href="source_31.html">Previous</a></li><li><a href="source_33.html">Next</a></li>
</ul>
</div>

<div class = "source">
<p class="indent0"><span class="heading">Section E(e) - Labyrinth rooms</span></p><p class="indent0">A labyrinth room is a kind of room. A labyrinth room has a labyrinth shape called shape. A labyrinth room has a text called map legend. A labyrinth room usually has map legend &quot;<span class="quote">-+-</span>&quot;. A labyrinth room has a number called minimum level. A labyrinth room usually has minimum level 1. A labyrinth room can be grovelike or ungrovelike. A labyrinth room is usually ungrovelike.</p><p class="indent0">Definition: A labyrinth room is unplaced if its grid position is &lt;0,0,0&gt;.</p><p class="indent0">Definition: A labyrinth room is unshaped if its shape is L0/0-0-0-0-0-0.</p><p class="indent0">Definition: A labyrinth room is ascending rather than non-ascending if the U part of its shape is 1 and the maze level part of its grid position is not 1.</p><p class="indent0">Definition: A labyrinth room is descending rather than non-descending if the D part of its shape is 1 and the maze level part of its grid position is not 9.</p><p class="indent0"><a name="note1ref"></a><span class="notecue"><a href="#note1">[1]</a></span></p><p class="indent0">After printing the name of an ascending labyrinth room, say &quot;<span class="quote"> with Staircase Up</span>&quot;.</p><p class="indent0">After printing the name of an descending labyrinth room, say &quot;<span class="quote"> with Staircase Down</span>&quot;.</p><p class="indent0"><span class="comment">[At the start of play, the game contains a large stock of labyrinth rooms which are not committed to any shape or position, but are waiting to be joined to the maze. The previous section's table is used to assign shapes to the rooms, but respecting their relative frequencies.]</span></p><p class="indent0">To calculate how many labyrinth rooms should have each shape:</p><p class="indent1">let total space be the number of unshaped labyrinth rooms;</p><p class="indent1">let total allocated be 0;</p><p class="indent1">let total frequency be 0%;</p><p class="indent1">if the total space is 0, stop;</p><p class="indent1">repeat through the Table of Shape Frequencies:</p><p class="indent2">now the shape count entry is 0;</p><p class="indent1">repeat through the Table of Shape Frequencies:</p><p class="indent2">let N be the parts per hundred part of the frequency entry;</p><p class="indent2">let N be N multiplied by the total space;</p><p class="indent2">now the shape count entry is N divided by 100;</p><p class="indent2">now the total allocated is the total allocated plus the shape count entry;</p><p class="indent2">let total frequency be total frequency plus the frequency entry;</p><p class="indent1">unless the total frequency is 100%,</p><p class="indent2">say &quot;<span class="quote">Oops: the frequency table totals up to [</span><span class="substitution">total frequency</span><span class="quote">].</span>&quot;;</p><p class="indent1"><span class="comment">[Nevertheless, if the cave extent is not a multiple of 50 we have probably under-allocated due to rounding errors. We make random draws to put this right.]</span></p><p class="indent1">while the total allocated is less than the total space:</p><p class="indent2">let total frequency be 0%;</p><p class="indent2">let R be a random number from 1 to 100;</p><p class="indent2">let the weighted percentage be the percentage with parts per hundred part R;</p><p class="indent2">repeat through the Table of Shape Frequencies:</p><p class="indent3">let total frequency be total frequency plus the frequency entry;</p><p class="indent3">if the weighted percentage &gt; 0% and the weighted percentage &lt;= the total frequency:</p><p class="indent4">now the shape count entry is the shape count entry plus 1;</p><p class="indent4">now the total allocated is the total allocated plus 1;</p><p class="indent4">now the weighted percentage is 0%.</p><p class="indent0">To give shape to the shapeless labyrinth rooms:</p><p class="indent1"><span class="comment">[Now we change the count entries so that a count entry of X means that the Xth room is the first to have the characteristics of the present row. In particular, there is guaranteed to be a row with a count entry of 1.]</span></p><p class="indent1">let total allocated be 0;</p><p class="indent1">repeat through the Table of Shape Frequencies:</p><p class="indent2">unless the shape count entry is 0:</p><p class="indent3">let new value be the total allocated plus 1;</p><p class="indent3">let total allocated be total allocated plus shape count entry;</p><p class="indent3">now the shape count entry is the new value;</p><p class="indent1"><span class="comment">[Now we go through the rooms, using the current row to set each one, and moving to the appropriate row whenever one of the start counts is hit. Since there is guaranteed to be a count entry of 1 somewhere, the changes can only be reached when a row has been chosen.]</span></p><p class="indent1">let total allocated be 0;</p><p class="indent1">repeat with blank room running through unshaped labyrinth rooms:</p><p class="indent2">let total allocated be total allocated plus 1;</p><p class="indent2">if there is a shape count of total allocated in the Table of Shape Frequencies, choose row with a shape count of total allocated in the Table of Shape Frequencies;</p><p class="indent2">now the shape of the blank room is the shape entry;</p><p class="indent2">now the map legend of the blank room is the legend entry;</p><p class="indent2">now the printed name of the blank room is the shape name entry.</p><p class="indent0">Before casting make sanctuary at: if the location is a labyrinth room or the location is the Budless Grove, say &quot;<span class="quote">You hear the laughter of the never-children in your mind, and know that you might as well save your strength.</span>&quot; instead.</p><p class="indent0">Before listing nondescript items when the location is a labyrinth room:</p><p class="indent1">now all hazards are unmarked for listing;</p><p class="indent1">if a hostile monster is marked for listing, say &quot;<span class="quote">The [</span><span class="substitution">if the current maze level is 1</span><span class="quote">]lawn[</span><span class="substitution">otherwise</span><span class="quote">]cave[</span><span class="substitution">end if</span><span class="quote">] is guarded by [</span><span class="substitution">a list of hostile monsters which are marked for listing</span><span class="quote">].</span>&quot;;</p><p class="indent1">now all hostile monsters are unmarked for listing.</p>
</div>

<div class ="notes">
<p><span class="notesheading">Note</span></p>
<p><a name="note1"></a><span class="notetext"><a href="#note1ref">[1]</a>.  The point here is that if a cave with an up staircase is found on the top level, the staircase must be ignored: similarly a down staircase on the bottom level.</span></p>

</div>

</div>

</body>

</html>
